# Ingest API - Swagger generated server

## Overview
This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the
[OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server, a server stub was easily generated.

This server uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

## Requirements
Python 3.8.10 or newer, preferably

The server uses PySpark (along with pandas) to communicate with the data lake. It is included in `requirements.txt`.

## Environment veriables
Some environment variables have to be set in order to correctly setup PySpark to connect to a remote Spark master.

- **INGEST_SPARK_MASTER**: the link to the Spark master (default: `local`). In roder to specify a remote master, provide a link like `spark://<MASTER_HOST>:<MASTER_PORT>`
- **SPARK_LOCAL_IP**: the Spark master may not find the API host with the default IP, so an accessible IP should be set
- **PYSPARK_PYTHON**: the location of the Python interpreter. This location has to be the same for both the API machine and the remote Spark master host (this should be an issue if the API is within a virtual environment)

Both Spark instances, the API's and the master's, should have the same version.

## Usage
To run the server, please execute the following from the root directory:

```
pip3 install -r requirements.txt
python3 -m swagger_server
```

and open your browser to here:

```
http://localhost:8080/api/ingest/ui/
```

The Swagger definition lives here:

```
http://localhost:8080/api/ingest/swagger.json
```

To launch the integration tests, use tox:
```
sudo pip install tox
tox
```

## Running with Docker

To run the server on a Docker container, please execute the following from the root directory:

```bash
# building the image
docker build -t swagger_server .

# starting up a container
docker run -p 8080:8080 swagger_server
```
